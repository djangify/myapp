{% extends "base.html" %}
{% load static %}

{% block content %}
<!-- HERO SECTION -->
<header class="p-6 bg-primary text-text relative md:p-16 flex flex-col gap-y-5 lg:gap-y-20">
  {% include 'core/hero.html' %}
</header>

<main class="bg-[color:var(--color-brand-light)] text-[color:var(--color-font-main)]">

  <!-- Shop Heading -->
  <section class="px-6 md:px-16 py-12 text-center space-y-4">
    <h1 class="text-4xl font-semibold text-[color:var(--color-brand-secondary)] mt-8">
      Latest Products
    </h1>
  </section>

  <!-- Category Pills -->
  <div id="categories-grid" class="flex flex-wrap justify-center gap-3 mb-12">
    <a href="{% url 'core:home' %}"
       class="px-4 py-2 rounded-md text-sm font-semibold border border-[color:var(--color-brand-accent)] text-[color:var(--color-brand-accent)] bg-[color:var(--color-brand-light)] hover:bg-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-light)] transition {% if not current_category %}bg-[color:var(--color-brand-accent)] text-[color:var(--color-brand-light)]{% endif %}">
       All Products
    </a>
    {% for category in categories %}
    <a href="?category={{ category.slug }}#shop"
       class="px-4 py-2 rounded-md text-sm font-semibold border border-[color:var(--color-brand-accent)] text-[color:var(--color-brand-accent)] bg-[color:var(--color-brand-light)] hover:bg-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-light)] transition {% if current_category and current_category.slug == category.slug %}bg-[color:var(--color-brand-accent)] text-[color:var(--color-brand-light)]{% endif %}">
       {{ category.name }}
    </a>
    {% endfor %}
  </div>

  <!-- PRODUCT GRID -->
  <section id="shop" class=" text-text py-12">
    <div class="max-w-7xl mx-auto px-6 md:px-12">
      {% if products %}
      <div class="grid gap-8 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        {% for product in products %}
        <div class="bg-[color:var(--color-brand-light)] border border-[color:var(--color-brand-accent)] rounded-lg p-4 hover:shadow-md transition-shadow duration-300 flex flex-col justify-between">
          <a href="{{ product.get_absolute_url }}">
            <figure class="mb-4 aspect-[3/4] flex items-center justify-center overflow-hidden rounded-md bg-[color:var(--color-brand-light)]">
              {% if product.get_image_url %}
                <img src="{{ product.get_image_url }}" alt="{{ product.title }}" class="object-contain w-full h-full">
              {% else %}
                <img src="{% static 'images/placeholder.webp' %}" alt="Placeholder" class="object-contain w-full h-full">
              {% endif %}
            </figure>
            <h3 class="text-lg font-semibold text-[color:var(--color-brand-primary)] mb-2">{{ product.title }}</h3>
          </a>

          <a href="?category={{ category.slug }}"
            class="px-4 py-2 rounded-md text-sm font-semibold border border-[color:var(--color-brand-accent)] text-[color:var(--color-brand-accent)] bg-[color:var(--color-brand-light)] hover:bg-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-light)] transition {% if current_category and current_category.slug == category.slug %}bg-[color:var(--color-brand-accent)] text-[color:var(--color-brand-light)]{% endif %}">
            {{ category.name }}
          </a>

          <div class="flex justify-between items-center mt-auto">
            <span class="text-lg font-semibold text-[color:var(--color-brand-accent)]">
              Â£{{ product.current_price }}
            </span>
            <a href="{{ product.get_absolute_url }}" class="text-sm uppercase text-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-primary)] transition">
              View
            </a>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if products.has_other_pages %}
      <div class="mt-12">
        <nav class="flex justify-center flex-wrap gap-2">
          {% if products.has_previous %}
          <a href="?page={{ products.previous_page_number }}"
             class="px-4 py-2 text-sm border border-[color:var(--color-brand-accent)] rounded-md bg-[color:var(--color-brand-light)] hover:bg-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-light)] transition">
             Previous
          </a>
          {% endif %}
          {% for num in products.paginator.page_range %}
            {% if products.number == num %}
            <span class="px-4 py-2 text-sm rounded-md bg-[color:var(--color-brand-accent)] text-[color:var(--color-brand-light)] border border-[color:var(--color-brand-accent)]">{{ num }}</span>
            {% else %}
            <a href="?page={{ num }}#shop"
               class="px-4 py-2 text-sm rounded-md border border-[color:var(--color-brand-accent)] bg-[color:var(--color-brand-light)] hover:bg-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-light)] transition">
               {{ num }}
            </a>
            {% endif %}
          {% endfor %}
          {% if products.has_next %}
          <a href="?page={{ products.next_page_number }}"
             class="px-4 py-2 text-sm border border-[color:var(--color-brand-accent)] rounded-md bg-[color:var(--color-brand-light)] hover:bg-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-light)] transition">
             Next
          </a>
          {% endif %}
        </nav>
      </div>
      {% endif %}
      {% else %}
      <p class="text-center text-[color:var(--color-font-main)]">No products available at the moment.</p>
      {% endif %}
    </div>
    
  </section>
</main>

<!-- JS -->
<script src="{% static 'js/category-filter.js' %}"></script>
{% endblock %}
